{% extends "layout.html" %}

{% block content %}

<head>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
    <script>
        function cargarRed() {
            var array = ["Seleccione red...", "FTTH", "EOC", "HFC"];
            //array.sort();
            addOptions("red", array);
        }

        //Función para agregar opciones a un <select>.
        function addOptions(domElement, array) {
            var selector = document.getElementsByName(domElement)[0];
            for (red in array) {
                var opcion = document.createElement("option");
                opcion.text = array[red];
                // Añadimos un value a los option para hacer mas facil escoger los pueblos
                opcion.value = array[red].toLowerCase()
                selector.add(opcion);
            }
        }

        function cargarHorarios() {
            // Objeto de provincias con pueblos
            var listaHorarios = {
              ftth: ["8 - 10", "10 - 12", "12 - 14", "14 - 16", "16 - 18"],
              eoc: ["8 - 9", "9 - 10", "10 - 11", "11 - 12", "12 - 13", "13 - 14", "14 - 15", "15 - 16", "16 - 17"],
              hfc: ["8 - 9", "9 - 10", "10 - 11", "11 - 12", "12 - 13", "13 - 14", "14 - 15", "15 - 16", "16 - 17"]
            }
            
            var redes = document.getElementById('red')
            var horarios = document.getElementById('horario')
            var redSeleccionada = redes.value
            
            // Se limpian los pueblos
            horarios.innerHTML = '<option value="">Seleccione horario...</option>'
            
            if(redSeleccionada !== ''){
              // Se seleccionan los pueblos y se ordenan
              redSeleccionada = listaHorarios[redSeleccionada]
              //redSeleccionada.sort()
            
              // Insertamos los pueblos
              redSeleccionada.forEach(function(horario){
                let opcion = document.createElement('option')
                opcion.value = horario
                opcion.text = horario
                horarios.add(opcion)
              });
            }
            
          }
    </script>
</head>

 <div class="row"><h3>Asignación de Tareas</h3></div>
  <div class="row">
    <div class="col-md-4">
        {% with messages = get_flashed_messages()  %}
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true" ></span>
            <!--<a href="/" aria-hidden="true">x</a>-->
          </button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %} 

        <div class="card card-body" style="width: 22rem;">
        <form action="{{url_for('add_tareas')}}" method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <h5>Fecha asignación:</h5>
            <div class="form-group">
              <input type="text" class="form-control" name="fecha" value="{{fecha}}" readonly="readonly">
            </div>
            <h5>Número solicitud:</h5>
            <div class="form-group">
              <input type="text" class="form-control" name="numsol" value="OS-{{auto_incre}}" readonly="readonly">
            </div>
            <div class="form-group">
                <select type="text" name="idtec" class="form-control select">
                    {% for row in tecnicos %}
                        <option>{{row}}</option>
                    {% endfor %}
                </select>    
              </div>
          <div class="form-group">
            <select type="text" name="zona" class="form-control select">
                {% for row1 in zonas %}
                    <option>{{row1}}</option>
                {% endfor %}
            </select>    
          </div>
          <div class="form-group">
            <select type="text" name="tipo" class="form-control select">
                <option value="Instalacion" selected>Instalación</option>
                <option value="Mantenimiento">Mantenimiento</option>
            </select>    
          </div>
          <div class="form-group">
            <select type="text" name="red"  id="red" onchange="cargarHorarios()" class="form-control select">
                <!--<option value="FTTH" selected>FTTH</option>
                <option value="EOC">EOC</option>
                <option value="HFC">HFC</option>
                <option value="">Seleccione red...</option>-->
            </select>    
          </div>         
          <div class="form-group">
            <input type="text" class="form-control" name="usuario" placeholder="Usuario">
          </div>
          <div class="form-group">
            <input type="text" class="form-control" name="direccion" placeholder="Dirección">
          </div>
          <div class="form-group">
            <textarea class="form-control" rows="5" name="detalles" placeholder="Detalles"></textarea>
          </div>
          <div class="form-group">
            <select type="text" name="horario" id="horario" class="form-control select">
              <!--<option value="8 - 10" selected>8 - 10</option>
                <option value="10 - 12">10 - 12</option>
                <option value="12 - 14">12 - 14</option>
                <option value="14 - 16">14 - 16</option>
                <option value="16 - 18">16 - 18</option>-->
              </select>    
          </div>
          <div class="form-group">
            <textarea class="form-control" rows="5" name="observaciones" placeholder="Observaciones"></textarea>
          </div>
          <button class="btn btn-primary btn-block">
            Registrar Tarea
          </button>
        </form>
      </div>  
    </div>
    <div class="col-md-7">
      <div class="row"><h3>Ordenes Pendientes</h3></div>
      <table id="example2" class="table table-striped table-bordered" style="width:100%">
        <thead>
          <tr>
            <td>Solicitud</td>
            <td>Técnico</td>
            <td>Zona</td>
            <td>Tipo de Tarea</td>
            <td>Red</td>
            <td>Horario</td>
            <td>Estado</td>
            <td>Fecha</td>
            <td>Acción</td>
          </tr>
        </thead>
        <tbody>
          {% for row in pendientes %}
          <tr>
            <td>{{row[0]}}</td>
            <td>{{row[1]}}</td>
            <td>{{row[2]}}</td>
            <td>{{row[3]}}</td>
            <td>{{row[4]}}</td>
            <td>{{row[7]}}</td>
            <td>{{row[9]}}</td>
            <td>{{row[10]}}</td>
            <td width="120px">
              <a href="/update_os_incompleta/{{row[0]}}" class="btn btn-danger btn-completar btn-primary">completar</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="col-md-9">
      <div class="row"><h3>Ordenes Asignadas</h3></div>
        <table id="example" class="table table-striped table-bordered" style="width:100%">
          <thead>
            <tr>
              <td>Solicitud</td>
              <td>Técnico</td>
              <td>Zona</td>
              <td>Tipo</td>
              <td>Red</td>
              <td>Usuario</td>
              <td>Dirección</td>
              <td>Detalle</td>
              <td>Horario</td>
              <td>Observacion</td>
              <td>Estado</td>
              <td>Fecha</td>
              <td>Acción</td>
            </tr>
          </thead>
          <tbody>
            {% for row in asignaciones %}
            <tr>
              <td>{{row[0]}}</td>
              <td>{{row[1]}}</td>
              <td>{{row[2]}}</td>
              <td>{{row[3]}}</td>
              <td>{{row[4]}}</td>
              <td>{{row[5]}}</td>
              <td>{{row[6]}}</td>
              <td>{{row[7]}}</td>
              <td>{{row[8]}}</td>
              <td>{{row[9]}}</td>
              <td>{{row[10]}}</td>
              <td>{{row[11]}}</td>
              <td width="120px">
                <a href="/edit_os/{{row[0]}}" class="btn btn-secondary btn-sm">editar</a>
                <!--<a href="/delete_os/{{row[1]}}" class="btn btn-danger btn-delete btn-sm">eliminar</a>-->
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
  </div>  
  </div>
</div>
  
{% endblock %}